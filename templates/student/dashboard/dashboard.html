<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Dashboard| MMEC AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/student/dashboard/dashboard.css">
<style>
    footer {
        background-color: rgba(255, 255, 255, 0.5);
        color: black;
    }
    .container {
        background-color: white;
        padding: 28px;
        margin: 24px auto;
        max-width: 820px;
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(15,23,42,0.06);
    }
    .sidebar {
        background-color: #0f172a; /* dark navy for contrast */
        color: #ffffff;
        width: 260px;
        position: fixed;
        right: 0;
        top: 0;
        height: 100%;
        overflow-y: auto;
        transition: transform 0.28s ease, opacity 0.28s ease;
        transform: translateX(0);
        z-index: 1200;
        display: flex;
        flex-direction: column;
    }
    .sidebar.collapsed { transform: translateX(100%); opacity: 0; }

    /* Footer and sidebar */
    .footer-content { display: flex; justify-content: space-around; padding: 10px; }
    .sidebar-content { padding: 18px 14px; flex: 1 1 auto; }
    .main-content { margin-right: 280px; padding: 20px; }

    /* Header & greeting centered */
    .header{ display:flex; justify-content:center; align-items:center; padding:26px 24px; position:relative; background: linear-gradient(90deg,#fff,#fff); border-radius:6px; }
    .header-title{ font-size:26px; font-weight:700; text-align:center; color:#0b1220 }
    /* Hamburger inside the header container: larger, colored, animated */
    .menu-btn{
        position:absolute;
        right:18px;
        top:50%;
        transform:translateY(-50%);
        background: linear-gradient(135deg,#2563eb,#4f46e5);
        border: none;
        color: white;
        font-size:20px;
        padding:10px 12px;
        border-radius:10px;
        cursor:pointer;
        box-shadow: 0 6px 18px rgba(79,70,229,0.18);
        transition: transform .22s ease, box-shadow .22s ease, background .22s ease;
        display:flex; align-items:center; justify-content:center;
    }
    .menu-btn:hover{ transform: translateY(-50%) scale(1.03); box-shadow:0 10px 26px rgba(79,70,229,0.22); }
    .menu-btn.open { transform: translateY(-50%) rotate(90deg); background: linear-gradient(135deg,#16a34a,#059669); }

    /* Sidebar items */
    .side-panel-title{ text-align:center; padding:12px 0; font-weight:600; font-size:18px; }
    .side-menu{ list-style:none; padding:0; margin:8px 0; }
    .side-menu li{ padding:12px 14px; display:flex; align-items:center; gap:12px; cursor:pointer; border-radius:10px; color: #071124; margin-bottom:8px; font-weight:600; box-shadow: 0 6px 18px rgba(2,6,23,0.08); }
    .side-menu li:hover{ transform: translateX(-6px); opacity: 0.98; }
    .side-menu .icon{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; border-radius:8px; font-size:18px; }
    /* colorful variants using nth-child */
    .side-menu li:nth-child(1){ background: linear-gradient(90deg,#fff7ed,#ffedd5); color:#7c2d12 }
    .side-menu li:nth-child(1) .icon{ background: linear-gradient(135deg,#ff7a18,#ffb199); color:#fff }
    .side-menu li:nth-child(2){ background: linear-gradient(90deg,#f0fdf4,#dcfce7); color:#065f46 }
    .side-menu li:nth-child(2) .icon{ background: linear-gradient(135deg,#10b981,#34d399); color:#fff }
    .side-menu li:nth-child(3){ background: linear-gradient(90deg,#ecfeff,#cffafe); color:#075985 }
    .side-menu li:nth-child(3) .icon{ background: linear-gradient(135deg,#06b6d4,#60a5fa); color:#fff }
    .side-menu li:nth-child(4){ background: linear-gradient(90deg,#eef2ff,#e0e7ff); color:#3730a3 }
    .side-menu li:nth-child(4) .icon{ background: linear-gradient(135deg,#6366f1,#8b5cf6); color:#fff }
    .side-menu li:nth-child(5){ background: linear-gradient(90deg,#fff1f2,#ffe4e6); color:#9f1239 }
    .side-menu li:nth-child(5) .icon{ background: linear-gradient(135deg,#fb7185,#f43f5e); color:#fff }

    .sidebar .logout-row{ padding:12px; border-top:1px solid rgba(255,255,255,0.06); }
    .sidebar .close-btn{ background:transparent;border:1px solid rgba(255,255,255,0.12); color:#fff; padding:6px 10px; border-radius:6px; cursor:pointer }

    /* make some cards responsive */
    .card-row{ display:grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap:12px }

    /* small helpers */
    .user-greeting{ font-size:22px; }
</style>
</head>
<body>

<!-- Sidebar Section (right side) -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-content">
        <div class="side-panel-title">Student Panel</div>
        <ul class="side-menu">
            <li data-href="/student"><span class="icon">üè†</span><span>Home</span></li>
            <li id="chat-link"><span class="icon">üí¨</span><span>Chat</span></li>
            <li id="history-link"><span class="icon">‚è±Ô∏è</span><span>History</span></li>
            <li id="logout-link"><span class="icon">üö™</span><span>Logout</span></li>
        </ul>
    </div>
    <div class="logout-row"><button class="close-btn" id="sidebar-close">Close</button></div>
</div>
<!-- End Sidebar Section -->

<!-- Main Content Section -->
<div class="main main-content">
    <div class="header">
        <button id="sidebar-toggle" class="menu-btn" aria-label="Toggle sidebar">‚ò∞</button>
        <h3 id="header-title" class="header-title"></h3>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard" id="dashboard">
        <div class="welcome-section">
            <div>
                <h1>Welcome to your Dashboard</h1>
                <p>Get quick answers to all your college queries instantly with our AI Assistant.</p>
            </div>
            <button class="lets-chat-button" onclick="window.location.href='/student/chat'">Let's Chat!</button>
        </div>

        <div class="card-row">
            <div class="info-card" style="--card-accent:#2563eb;">
                <span class="icon">üß†</span>
                <h4>Domain</h4>
                <p>AI‚ÄëDriven College Enquiry Chatbot</p>
            </div>
            <div class="info-card" style="--card-accent:#10b981;">
                <span class="icon">üìä</span>
                <h4>Dataset Source</h4>
                <p>Self‚ÄëMade</p>
            </div>
            <div class="info-card" style="--card-accent:#f59e0b;">
                <span class="icon">‚öôÔ∏è</span>
                <h4>Algorithm</h4>
                <p>NLP ¬∑ Cosine Similarity</p>
            </div>
            <div class="info-card" style="--card-accent:#8b5cf6;">
                <span class="icon">üåê</span>
                <h4>Framework</h4>
                <p>Flask</p>
            </div>
        </div>

        <div class="section-box" id="student-logs-section">
            <h3>Student Logs</h3>
            <p id="student-logs-desc">Loading...</p>
            <div id="student-logs-content" style="margin-top:12px;"></div>
        </div>

        <div class="section-box">
            <h3>Project Overview</h3>
            <p>This project aims to address the challenges faced by colleges in handling a high volume of student inquiries, particularly during peak admission periods. Traditional methods involving limited staff often lead to delayed responses and increased wait times, negatively impacting the student experience. By leveraging artificial intelligence, we propose an AI-driven chatbot solution to provide immediate, accurate, and consistent responses to common student questions.</p>
        </div>

        <div class="section-box">
            <h3>Problem Statement</h3>
            <p>College enquiries are overwhelming due to high student volume and limited staff availability. A chatbot provides immediate, accurate responses and reduces wait time.</p>
        </div>

        <div class="section-box">
            <h3>Proposed Solution</h3>
            <p>An NLP chatbot integrated with college data to answer queries on admissions, fees, courses, scholarships, and more.</p>
        </div>

        <!-- New Admissions Section -->
        <div class="section-box" id="admissions-section">
            <h3>Admissions</h3>
            <div id="admissions-content">
                <h4>Eligibility Criteria</h4>
                <ul>
                    <li>Must have completed 10+2 or equivalent examination.</li>
                    <li>Minimum 50% aggregate marks in the qualifying examination.</li>
                    <li>Valid score in the entrance examination (if applicable).</li>
                </ul>

                <h4>Admission Process</h4>
                <ol>
                    <li>Fill out the online application form.</li>
                    <li>Upload required documents: ID proof, address proof, educational certificates.</li>
                    <li>Pay the application fee through the available online methods.</li>
                    <li>Submit the form and take a printout for future reference.</li>
                </ol>

                <h4>Important Dates</h4>
                <p>Application Deadline: <strong>30th June 2023</strong></p>
                <p>Entrance Exam Date: <strong>15th July 2023</strong></p>
                <p>Interview Dates: <strong>20th - 25th July 2023</strong></p>
                <p>Admission Confirmation: <strong>30th July 2023</strong></p>
            </div>
        </div>

        
    </div>
</div>
<script>
    // Initialize header with user info
    (function initHeader(){
        const hdr = document.getElementById('header-title');
        const name = localStorage.getItem('mmec_name') || localStorage.getItem('mmec_user') || '';
        const role = localStorage.getItem('mmec_role') || '';
        hdr.textContent = name ? `Hello, ${name} üëã` : 'Hello Student';
        hdr.classList.add('user-greeting');
        // show role when it's not the default Student label
        if (role && role.toLowerCase() !== 'student') {
            const roleSpan = document.createElement('span');
            roleSpan.className = 'user-role';
            roleSpan.textContent = ` ‚Ä¢ ${role}`;
            hdr.appendChild(roleSpan);
            hdr.classList.add('is-admin');
        }

        // sidebar toggle behavior: also expand main-content to full width when collapsed
        const toggle = document.getElementById('sidebar-toggle');
        const sidebar = document.querySelector('.sidebar');
        const main = document.querySelector('.main-content');
        function applySidebarState(collapsed){
            if (collapsed) {
                sidebar.classList.add('collapsed');
                if (main) main.style.marginRight = '0';
            } else {
                sidebar.classList.remove('collapsed');
                if (main) main.style.marginRight = '280px';
            }
            localStorage.setItem('sidebar_collapsed', collapsed ? '1' : '0');
        }
        toggle.addEventListener('click', ()=>{
            const isCollapsed = sidebar.classList.toggle('collapsed');
            applySidebarState(isCollapsed);
            // animate toggle button
            toggle.classList.toggle('open', isCollapsed);
            toggle.setAttribute('aria-expanded', (!isCollapsed).toString());
        });
        // restore state
        const wasCollapsed = localStorage.getItem('sidebar_collapsed') === '1';
        applySidebarState(wasCollapsed);
        // reflect state on toggle button
        toggle.classList.toggle('open', wasCollapsed);
        toggle.setAttribute('aria-expanded', (!wasCollapsed).toString());
    })();

    // Placeholder functions for navigation/auth
    async function showHistory() {
        window.location.href = '/student/chat'; // Redirect to chat page for history
    }

    function logout() {
        localStorage.removeItem('mmec_token');
        localStorage.removeItem('mmec_user');
        localStorage.removeItem('mmec_role');
        localStorage.removeItem('mmec_name');
        localStorage.removeItem('mmec_email');
        // If user is on chat page, send them back to student dashboard; otherwise go to login
        const path = (window.location.pathname || '').toLowerCase();
        if (path.includes('/student/chat')) {
            window.location.href = '/student/dashboard';
        } else {
            window.location.href = '/login';
        }
    }

    // Load Student Logs / Registered Students
    async function loadStudentLogs(){
        const container = document.getElementById('student-logs-content');
        const desc = document.getElementById('student-logs-desc');
        container.innerHTML = '';
        desc.textContent = 'Loading...';
        const role = localStorage.getItem('mmec_role') || 'Student';
        const token = localStorage.getItem('mmec_token');
        if (role === 'Admin'){
            // Admin: fetch registered students
            try{
                const res = await fetch('/api/admin/students', { headers: token ? {'X-Session-Token': token} : {} });
                const txt = await res.text();
                let data = {};
                try{ data = JSON.parse(txt); } catch(e){ data = { ok: false, error: txt }; }
                if (data.ok && Array.isArray(data.students)){
                    desc.textContent = `Showing ${data.students.length} registered students`;
                    const table = document.createElement('table');
                    table.style.width = '100%';
                    table.style.borderCollapse = 'collapse';
                    table.innerHTML = `<thead><tr><th style="text-align:left;padding:8px">Name</th><th style="text-align:left;padding:8px">Email</th><th style="text-align:left;padding:8px">Marks</th><th style="text-align:left;padding:8px">Notes</th></tr></thead>`;
                    const tbody = document.createElement('tbody');
                    data.students.forEach(s=>{
                        const tr = document.createElement('tr');
                        tr.innerHTML = `<td style="padding:8px;border-top:1px solid #eee">${s.name||''}</td><td style="padding:8px;border-top:1px solid #eee">${s.email||''}</td><td style="padding:8px;border-top:1px solid #eee">${s.marks||''}</td><td style="padding:8px;border-top:1px solid #eee">${s.notes||''}</td>`;
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);
                    container.appendChild(table);
                } else {
                    desc.textContent = `Unable to load students: ${data.error || 'no data'}`;
                    container.innerHTML = '';
                }
            }catch(e){
                desc.textContent = 'Error fetching student list.';
                container.innerHTML = '';
            }
        } else {
            // Regular student: show profile from localStorage
            const user = localStorage.getItem('mmec_name') || localStorage.getItem('mmec_user') || 'Guest';
            const email = (localStorage.getItem('mmec_email') || '').trim();
            desc.textContent = 'Your Profile';
            const dl = document.createElement('div');
            const emailHtml = email ? `<div style="padding:8px 0"><strong>Email:</strong> ${email}</div>` : `<div style="padding:8px 0;color:#b91c1c"><strong>Email:</strong> Not provided</div>`;
            dl.innerHTML = `<div style="padding:8px 0"><strong>Name:</strong> ${user}</div>${emailHtml}<div style="padding:8px 0"><strong>Role:</strong> Student</div>`;
            container.appendChild(dl);

            // Basic email validation and visible warning
            if (email && !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
                const warn = document.createElement('div');
                warn.style.color = '#b91c1c';
                warn.style.marginTop = '8px';
                warn.textContent = 'Warning: The email looks invalid. Please check it in your profile.';
                container.appendChild(warn);
            }
        }
    }

    const refreshBtn = document.getElementById('refresh-logs');
    if (refreshBtn) refreshBtn.addEventListener('click', ()=> loadStudentLogs());

    // Wire up sidebar controls and quick links
    window.addEventListener('load', ()=>{
        loadStudentLogs();

        // sidebar close button
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebar = document.getElementById('sidebar');
        if (sidebarClose && sidebar) sidebarClose.addEventListener('click', ()=>{
            sidebar.classList.add('collapsed');
            localStorage.setItem('sidebar_collapsed','1');
        });

        // links
        const chatLink = document.getElementById('chat-link');
        if (chatLink) chatLink.addEventListener('click', ()=> window.location.href = '/student/chat');
        const historyLink = document.getElementById('history-link');
        if (historyLink) historyLink.addEventListener('click', ()=> window.location.href = '/student/chat');
        const logoutLink = document.getElementById('logout-link');
        if (logoutLink) logoutLink.addEventListener('click', ()=> logout());

        // any menu item with data-href
        document.querySelectorAll('.side-menu li[data-href]').forEach(li=>{
            li.addEventListener('click', ()=>{
                const href = li.getAttribute('data-href');
                if (href) window.location.href = href;
            });
        });
    });
</script>
</body>
</html>